<odoo>
    <data>
        <record id="view_purchase_order_form" model="ir.ui.view">
            <field name="name">view_purchase_order_form</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//div[hasclass('oe_button_box')]" position="inside">
                    <button type="object" name="action_view_order_return" class="oe_stat_button" icon="fa-truck"
                            attrs="{'invisible':[('order_return_ids','=',[])]}">
                        <field name="order_return_count" widget="statinfo" string="退货单"/>
                        <field name="order_return_ids" invisible="1"/>
                    </button>
                </xpath>

                <xpath expr="//button[@name='action_rfq_send']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='print_quotation']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='button_confirm']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@name='button_approve']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@id='draft_confirm']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>
                <xpath expr="//button[@id='bid_confirm']" position="attributes">
                    <attribute name="invisible">1</attribute>
                </xpath>

                <xpath expr="//button[@id='bid_confirm']" position="after">
                    <button name="button_confirm1" type="object" class="oe_highlight" states="draft" string="确认"/>
                    <button name="button_confirm2" type="object" class="oe_highlight" states="draft,confirm"
                            string="发送OA审批"/>
                    <button name="button_return" type="object" states="done" string="退货"/>
                </xpath>
                <field name="state" position="attributes">
                    <attribute name="statusbar_visible">draft,confirm,oa_sent,done</attribute>
                </field>


                <xpath expr="//field[@name='partner_id']" position="attributes">
                    <attribute name="options">{'no_create': 1}</attribute>
                    <attribute name="context">{'search_default_supplier':1, 'default_supplier':1, 'default_customer':0, 'show_vat': True, 'form_view_ref': 'cj_purchase.view_partner_supplier_form', 'tree_view_ref': 'cj_purchase.view_partner_supplier_tree'}</attribute>
                </xpath>
                <!--<field name="partner_ref" position="after">-->
                <!--<field name="payment_term_id" required="1" options="{'no_create': 1}" string="付款方式"/>-->
                <!--</field>-->
                <field name="date_order" position="after">
                    <field name="apply_id" options="{'no_create': 1}"/>
                </field>
                <field name="incoterm_id" position="after">
                    <field name="flow_id" readonly="1"/>
                    <field name="payment_time" widget="float_time"/>
                    <field name="deliver_time" widget="float_time"/>
                    <field name="logistics_time" widget="float_time"/>
                    <field name="arrival_time" widget="float_time"/>
                </field>

                <field name="partner_ref" position="after">
                    <field name="rebate"/>
                </field>

                <xpath expr="//page[@name='purchase_delivery_invoice']/group" position="after">
                    <group>
                        <field name="explain"/>
                    </group>
                </xpath>

                <xpath expr="//page[@name='purchase_delivery_invoice']" position="after">
                    <page string="物流单">
                        <field name="transport_ids">
                            <tree editable="bottom">
                                <field name="name"/>
                                <field name="type"/>
                                <field name="receiver_name"/>
                                <field name="receiver_phone"/>
                                <field name="receiver_address"/>
                            </tree>
                        </field>
                    </page>
                    <page string="供应商返利" attrs="{'invisible': [('rebate', '=', False)]}">
                        <group col="4">
                            <field name="rebate_type" attrs="{'required': [('rebate', '=', True)]}"/>
                            <field name="rebate_time" attrs="{'required': [('rebate', '=', True)]}"/>
                            <field name="rebate_amount" attrs="{'invisible': [('rebate_type', '!=', 'money')]}"/>
                            <field name="delay_days" attrs="{'invisible': [('rebate_time', '!=', 'delay')]}"/>

                        </group>
                        <field name="rebate_line_ids" attrs="{'invisible': [('rebate_type', '!=', 'product')]}">
                            <tree editable="bottom">
                                <field name="product_id" required="1"/>
                                <field name="uom_id" required="1"/>
                                <field name="qty" required="1"/>
                            </tree>
                        </field>
                    </page>
                </xpath>

                <!--采购订单明细增加payment_term_id(支付条款)字段-->
                <xpath expr="//field[@name='order_line']/tree/field[@name='date_planned']" position="after">
                    <field name="payment_term_id"/>
                </xpath>
                <!--采购明细增加partner_id的上下文，以方便默认payment_term_id字段值-->
                <xpath expr="//field[@name='order_line']" position="attributes">
                    <attribute name="context">{'partner_id': partner_id, 'payment_term_id': payment_term_id}</attribute>
                </xpath>

                <!--限制作业类型-->
                <field name="picking_type_id" position="attributes">
                    <attribute name="domain">[('warehouse_id.company_id', '=', company_id), ('code', '=', 'incoming')]</attribute>
                </field>
            </field>
        </record>


    </data>
</odoo>